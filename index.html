<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ðŸŽ† Cinematic Fireworks with Built-in SFX ðŸŽ†</title>
<style>
  html, body { margin:0; padding:0; overflow:hidden; height:100%; background:#010101; touch-action: manipulation; }
  h1 {
    position:absolute; top:40%; width:100%; text-align:center;
    font-family:"Poppins", sans-serif; color:#ffd700; font-size:2em;
    text-shadow:0 0 20px #ffaa00,0 0 50px #ff3c00; opacity:0.7;
    pointer-events:none; user-select:none;
  }
  canvas { position:absolute; inset:0; }
</style>
</head>
<body>
<h1>ðŸŽ† Tap or Click to Ignite the Sky ðŸŽ†</h1>
<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let w, h;
resize();
window.addEventListener('resize', resize);
function resize(){ w=canvas.width=innerWidth; h=canvas.height=innerHeight; }

let fireworks=[], particles=[], flashes=[];
const palette = ['#ffd700','#ff4500','#ff1493','#00ffff','#8a2be2'];

// --- Web Audio API SFX ---
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function playSFX(type){
  const osc = audioCtx.createOscillator();
  const gainNode = audioCtx.createGain();
  osc.connect(gainNode); gainNode.connect(audioCtx.destination);
  osc.type = 'square';
  let duration = 0.1, freq = 0;
  if(type==='launch'){ freq=400; duration=0.15; }
  else if(type==='boom'){ freq=150; duration=0.25; }
  else if(type==='crackle'){ freq=800 + Math.random()*400; duration=0.05; }
  osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
  gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
  osc.start();
  osc.stop(audioCtx.currentTime + duration);
}

// --- Firework Classes ---
class Firework {
  constructor(sx, sy, tx, ty){
    this.x=sx; this.y=sy; this.tx=tx; this.ty=ty;
    this.coordinates=[]; this.coordCount=5; while(this.coordCount--) this.coordinates.push([sx,sy]);
    this.angle=Math.atan2(ty-sy,tx-sx); this.speed=6; this.acceleration=1.03;
    this.color = palette[Math.floor(Math.random()*palette.length)];
    playSFX('launch');
  }
  update(i){
    this.coordinates.pop(); this.coordinates.unshift([this.x,this.y]);
    this.speed*=this.acceleration;
    const vx=Math.cos(this.angle)*this.speed;
    const vy=Math.sin(this.angle)*this.speed;
    if(Math.hypot(this.x-this.tx,this.y-this.ty)<this.speed){
      this.explode(); fireworks.splice(i,1);
    } else { this.x+=vx; this.y+=vy; }
  }
  draw(){
    ctx.beginPath();
    const last=this.coordinates[this.coordinates.length-1];
    ctx.moveTo(last[0],last[1]); ctx.lineTo(this.x,this.y);
    ctx.strokeStyle=this.color;
    ctx.stroke();
  }
  explode(){
    flashes.push({x:this.tx,y:this.ty,alpha:1,size:0,color:this.color});
    playSFX('boom');
    const layers=[{count:25,speed:4},{count:35,speed:3},{count:20,speed:2}];
    layers.forEach(layer=>{
      for(let i=0;i<layer.count;i++){
        const angle=Math.random()*Math.PI*2;
        const speed=Math.random()*layer.speed+1;
        particles.push(new Particle(this.tx,this.ty,this.color,angle,speed));
      }
    });
  }
}

class Particle {
  constructor(x,y,color,angle,speed){
    this.x=x; this.y=y; this.color=color; this.angle=angle; this.speed=speed;
    this.friction=0.96; this.gravity=0.15; this.alpha=1; this.decay=Math.random()*0.015+0.007;
    this.size=Math.random()*2+1; this.trail=[];
  }
  update(i){
    this.trail.push({x:this.x,y:this.y});
    if(this.trail.length>3) this.trail.shift();
    this.speed*=this.friction;
    this.x+=Math.cos(this.angle)*this.speed;
    this.y+=Math.sin(this.angle)*this.speed+this.gravity;
    this.alpha-=this.decay;
    if(Math.random()<0.02){ playSFX('crackle'); }
    if(this.alpha<=0) particles.splice(i,1);
  }
  draw(){
    ctx.globalCompositeOperation='lighter';
    ctx.shadowBlur = 8;
    ctx.shadowColor = this.color;
    ctx.strokeStyle = this.color;
    ctx.lineWidth = 2;
    ctx.beginPath();
    const last=this.trail[0]||{x:this.x,y:this.y};
    ctx.moveTo(last.x,last.y);
    ctx.lineTo(this.x,this.y);
    ctx.stroke();
    ctx.shadowBlur = 0;
    ctx.globalCompositeOperation='source-over';
  }
}

// --- Animation Loop ---
function animate(){
  ctx.fillStyle='rgba(0,0,0,0.2)'; ctx.fillRect(0,0,w,h);
  flashes.forEach((f,i)=>{
    f.size+=30; f.alpha-=0.1;
    ctx.globalAlpha=f.alpha*0.3; ctx.fillStyle=f.color;
    ctx.beginPath(); ctx.arc(f.x,f.y,f.size,0,Math.PI*2); ctx.fill();
    ctx.globalAlpha=1; if(f.alpha<=0) flashes.splice(i,1);
  });
  fireworks.forEach((fw,i)=>{ fw.update(i); fw.draw(); });
  particles.forEach((p,i)=>{ p.update(i); p.draw(); });
  requestAnimationFrame(animate);
}

// --- User Interaction ---
canvas.addEventListener('click', e=>fireworks.push(new Firework(w/2,h,e.clientX,e.clientY)));
canvas.addEventListener('touchstart', e=>{ const t=e.touches[0]; fireworks.push(new Firework(w/2,h,t.clientX,t.clientY)); });

animate();
</script>
</body>
</html>
